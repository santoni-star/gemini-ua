# Хуки (Hooks) у Gemini CLI

Хуки — це скрипти або програми, які Gemini CLI виконує у певних точках циклу
роботи агента. Вони дозволяють перехоплювати та налаштовувати поведінку програми
без зміни її вихідного коду.

## Що таке хуки?

За допомогою хуків ви можете:

- **Додавати контекст:** Вставляти інформацію перед тим, як модель обробить
  запит.
- **Перевіряти дії:** Переглядати та блокувати потенційно небезпечні операції.
- **Логувати взаємодії:** Відстежувати використання інструментів та відповіді
  моделі.
- **Оптимізувати поведінку:** Динамічно коригувати вибір інструментів.

Хуки працюють синхронно: коли виникає подія, CLI чекає завершення всіх
відповідних хуків перед продовженням роботи.

## Основні поняття

### Події хуків (Hook events)

Хуки запускаються певними подіями життєвого циклу CLI:

| Подія          | Коли спрацьовує                                        |
| -------------- | ------------------------------------------------------ |
| `SessionStart` | Початок сесії (запуск, відновлення).                   |
| `SessionEnd`   | Завершення сесії.                                      |
| `BeforeAgent`  | Після введення запиту користувачем, перед плануванням. |
| `AfterAgent`   | Після завершення циклу агента.                         |
| `BeforeModel`  | Перед відправкою запиту до LLM.                        |
| `AfterModel`   | Після отримання відповіді від LLM.                     |
| `BeforeTool`   | Перед виконанням інструменту.                          |
| `AfterTool`    | Після виконання інструменту.                           |

### Типи хуків

Наразі Gemini CLI підтримує **командні хуки**, які запускають shell-скрипти:

```json
{
  "type": "command",
  "command": "./scripts/my-hook.sh",
  "timeout": 30000
}
```

## Контракт вводу/виводу

Хуки взаємодіють через:

- **Ввід:** JSON через `stdin`.
- **Вивід:** Код виходу (exit code) та `stdout/stderr`.

### Коди виходу

- **0:** Успіх.
- **2:** Блокуюча помилка — операція буде зупинена, а повідомлення з `stderr`
  показане користувачеві.

## Конфігурація

Хуки налаштовуються у файлі `settings.json` у блоці `hooks`. Вони можуть бути
визначені на рівні проекту, користувача або системи.

Приклад:

```json
{
  "hooks": {
    "BeforeTool": [
      {
        "matcher": "write_file|replace",
        "hooks": [
          {
            "name": "check-security",
            "type": "command",
            "command": "./security-check.sh"
          }
        ]
      }
    ]
  }
}
```

## Керування хуками

- **Перегляд:** Використовуйте команду `/hooks panel` всередині CLI.
- **Увімкнення/Вимкнення:** `/hooks enable назва-хука` або
  `/hooks disable назва-хука`.
