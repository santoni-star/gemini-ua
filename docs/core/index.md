# Ядро (Core) Gemini CLI

Пакет ядра Gemini CLI (`packages/core`) — це бекенд-частина системи, яка
відповідає за взаємодію з Gemini API, керування інструментами та обробку запитів
від `packages/cli`.

## Навігація розділом

- **[Core tools API](./tools-api.md):** Як інструменти визначаються та
  реєструються.
- **[Memory Import Processor](./memport.md):** Модульний імпорт у файлах
  GEMINI.md через `@file.md`.
- **[Механізм політик (Policy Engine)](./policy-engine.md):** Тонкий контроль
  над виконанням інструментів.

## Роль ядра

Поки `packages/cli` забезпечує інтерфейс користувача, `packages/core` відповідає
за:

- **Взаємодію з Gemini API:** Безпечна передача підказок та отримання
  відповідей.
- **Промпт-інжиніринг:** Формування ефективних запитів з урахуванням історії та
  файлів `GEMINI.md`.
- **Оркестрація інструментів:**
  - Реєстрація доступних інструментів.
  - Виконання інструментів з отриманими від моделі аргументами.
  - Повернення результатів моделі для фінальної відповіді.
- **Керування сесіями:** Відстеження стану розмови та контексту.
- **Конфігурація:** Керування ключами API, вибором моделей та налаштуваннями
  інструментів.

## Безпека

Ядро відіграє ключову роль у безпеці:

- **Керування ключами:** Безпечне використання `GEMINI_API_KEY`.
- **Виконання інструментів:** Робота з локальною системою (наприклад, через
  `run_shell_command`) відбувається з обережністю, часто з використанням
  пісочниці.

## Стиснення історії чату

Щоб довгі розмови не перевищували ліміти токенів, ядро автоматично стискає
історію, коли вона наближається до ліміту обраної моделі. Це дозволяє зберігати
суть розмови, витрачаючи менше токенів.

## Перемикання моделей (Fallback)

Якщо основна модель (наприклад, "pro") досягає ліміту запитів (rate-limit), ядро
автоматично перемикається на модель "flash" для поточної сесії, щоб ви могли
продовжувати роботу.

## Сервіс пам'яті (Memory Discovery)

Шукає та завантажує файли `GEMINI.md` ієрархічно: від поточної папки вгору до
кореня проекту та домашнього каталогу користувача. Це дозволяє мати глобальні,
проектні та локальні налаштування контексту одночасно.
