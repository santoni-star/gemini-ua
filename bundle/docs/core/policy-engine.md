# Механізм політик (Policy Engine)

Gemini CLI містить потужний механізм політик, який забезпечує тонкий контроль
над виконанням інструментів. Він дозволяє визначати правила, які вирішують, чи
дозволити виклик інструменту автоматично, чи заборонити його, чи запитати
підтвердження у користувача.

## Швидкий старт

Щоб створити свою першу політику:

1.  **Створіть каталог для політик**, якщо він не існує:
    ```bash
    mkdir -p ~/.gemini/policies
    ```
2.  **Створіть новий файл політики** (наприклад,
    `~/.gemini/policies/my-rules.toml`):
    ```toml
    [[rule]]
    toolName = "run_shell_command"
    commandPrefix = "git status"
    decision = "allow"
    priority = 100
    ```
3.  **Запустіть команду**, яка активує правило. Тепер `git status`
    виконуватиметься автоматично без запиту підтвердження.

## Основні концепції

Кожне правило — це комбінація умов та рішення.

- **Умови (Conditions)**: Критерії, яким має відповідати виклик інструменту
  (назва інструменту, аргументи тощо).
- **Рішення (Decision)**: Дія у разі збігу (`allow` — дозволити, `deny` —
  заборонити, `ask_user` — запитати користувача).
- **Пріоритет (Priority)**: Число від 0 до 999. Чим вище число, тим важливіше
  правило.

### Система рівнів (Tiers)

Для вирішення конфліктів політики розділені на три рівні:

| Рівень  | База | Опис                                 |
| :------ | :--- | :----------------------------------- |
| Default | 1    | Вбудовані політики Gemini CLI.       |
| User    | 2    | Власні політики користувача.         |
| Admin   | 3    | Політики адміністратора організації. |

Фінальний пріоритет обчислюється так: `база_рівня + (пріоритет_у_файлі / 1000)`.
Це гарантує, що політики адміна завжди важливіші за ваші, а ваші — важливіші за
вбудовані.

## Синтаксис правил TOML

```toml
[[rule]]
# Назва інструменту (або масив назв)
toolName = "run_shell_command"

# Регулярний вираз для перевірки аргументів
argsPattern = '"command":"(git|npm)'

# Скорочення для shell-команд (префікс)
commandPrefix = "git "

# Рішення: "allow", "deny" або "ask_user"
decision = "ask_user"

# Пріоритет від 0 до 999
priority = 10
```

## Політики за замовчуванням

- **Інструменти тільки для читання** (`read_file`, `glob`) — зазвичай дозволені
  (`allow`).
- **Інструменти запису** (`write_file`, `run_shell_command`) — зазвичай
  вимагають підтвердження (`ask_user`).
- **Режим YOLO** — автоматично дозволяє все через правило з найвищим
  пріоритетом.
