# Довідник хуків (Hooks Reference)

Цей документ містить технічну специфікацію для хуків Gemini CLI, включаючи схеми
JSON для вводу та виводу, поведінку кодів виходу та API моделей.

## Протокол взаємодії

Хуки взаємодіють із Gemini CLI через стандартні потоки та коди виходу:

- **Ввід (Input)**: Gemini CLI надсилає JSON-об'єкт у `stdin` хука.
- **Вивід (Output)**: Хук надсилає JSON-об'єкт (або звичайний текст) у `stdout`.
- **Коди виходу (Exit Codes)**: Використовуються для сигналізації про успіх або
  критичні помилки.

### Поведінка кодів виходу

| Код виходу | Значення             | Поведінка                                                                               |
| :--------- | :------------------- | :-------------------------------------------------------------------------------------- |
| `0`        | **Успіх**            | `stdout` парситься як JSON. Якщо парсинг не вдається, текст вважається `systemMessage`. |
| `2`        | **Блокуюча помилка** | Перериває поточну операцію. `stderr` показується агенту або користувачеві.              |
| Інші       | **Попередження**     | Виконання продовжується. `stderr` записується у лог як некритичне попередження.         |

## Схема вводу (`stdin`)

Кожен хук отримує базовий JSON-об'єкт. Додаткові поля додаються залежно від
конкретної події.

### Базові поля (всі події)

- `session_id`: Унікальний ідентифікатор сесії CLI.
- `cwd`: Поточний робочий каталог.
- `hook_event_name`: Назва події (наприклад, `BeforeTool`).
- `timestamp`: Мітка часу ISO 8601.

## Схема виводу (`stdout`)

Якщо хук завершується з кодом `0`, CLI намагається прочитати `stdout` як JSON.

### Основні поля виводу

- `decision`: Одне з значень: `allow` (дозволити), `deny` (заборонити), `block`,
  `ask`, `approve`.
- `reason`: Пояснення для **агента**, якщо рішення `deny` або `block`.
- `systemMessage`: Повідомлення для **користувача** в терміналі.
- `continue`: Якщо `false`, цикл агента негайно зупиняється на цьому кроці.
- `hookSpecificOutput`: Контейнер для специфічних даних події (наприклад,
  `additionalContext` або `llm_request`).

## API моделей (Stable Model API)

Gemini CLI використовує стабільний формат для взаємодії з моделями, що гарантує
роботу ваших хуків навіть при зміні SDK Gemini.

### Об'єкт `LLMRequest`

Використовується в `BeforeModel` та `BeforeToolSelection`. Містить модель,
повідомлення, конфігурацію (`temperature` тощо) та `toolConfig`.

### Об'єкт `LLMResponse`

Використовується в `AfterModel`. Містить текст відповіді, кандидатів, причини
завершення (`finishReason`) та метадані використання токенів.
