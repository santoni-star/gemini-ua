# Розширене налаштування моделей

Цей посібник детально описує систему конфігурації моделей (Model Configuration)
у Gemini CLI. Розроблена для дослідників, інженерів якості ШІ та просунутих
користувачів, ця система забезпечує сувору структуру для керування
гіперпараметрами та поведінкою генеративних моделей.

> **Попередження**: Це функція для досвідчених користувачів. Значення
> конфігурації передаються безпосередньо провайдеру моделі з мінімальною
> валідацією. Неправильні налаштування (наприклад, несумісні комбінації
> параметрів) можуть призвести до помилок виконання з боку API.

## 1. Огляд системи

Система конфігурації моделей (`ModelConfigService`) забезпечує детермінований
контроль над генерацією. Вона відокремлює запитуваний ідентифікатор моделі
(наприклад, прапорець CLI або запит агента) від базової конфігурації API. Це
дозволяє:

- **Точне налаштування гіперпараметрів**: Прямий контроль над `temperature`,
  `topP`, `thinkingBudget` та іншими параметрами SDK.
- **Поведінка залежно від середовища**: Окремі конфігурації для різних
  контекстів роботи (наприклад, тестування проти продакшену).
- **Налаштування на рівні агента**: Застосування специфічних налаштувань лише
  тоді, коли активний певний агент.

Система базується на двох основних примітивах: **Аліаси (Aliases)** та
**Перевизначення (Overrides)**.

## 2. Примітиви конфігурації

Ці налаштування знаходяться під ключем `modelConfigs` у вашому файлі
конфігурації.

### Аліаси (`customAliases`)

Аліаси — це іменовані пресети конфігурації для багаторазового використання.
Користувачі повинні визначати власні аліаси (або перевизначати системні) у
словнику `customAliases`.

- **Успадкування**: Аліас може розширювати (`extends`) інший аліас (включаючи
  системні, такі як `chat-base`), успадковуючи його `modelConfig`. Дочірні
  аліаси можуть перезаписувати або доповнювати успадковані налаштування.
- **Абстрактні аліаси**: Аліас не обов'язково має вказувати конкретну `model`,
  якщо він слугує суто базою для інших аліасів.

**Приклад ієрархії**:

```json
"modelConfigs": {
  "customAliases": {
    "base": {
      "modelConfig": {
        "generateContentConfig": { "temperature": 0.0 }
      }
    },
    "chat-base": {
      "extends": "base",
      "modelConfig": {
        "generateContentConfig": { "temperature": 0.7 }
      }
    }
  }
}
```

### Перевизначення (`overrides`)

Перевизначення — це умовні правила, які впроваджують конфігурацію на основі
контексту виконання. Вони оцінюються динамічно для кожного запиту до моделі.

- **Критерії відповідності**: Перевизначення застосовуються, коли контекст
  запиту відповідає вказаним властивостям `match`.
  - `model`: Відповідає запитуваній назві моделі або аліасу.
  - `overrideScope`: Відповідає конкретній області запиту (зазвичай назва
    агента, наприклад, `codebaseInvestigator`).

**Приклад перевизначення**:

```json
"modelConfigs": {
  "overrides": [
    {
      "match": {
        "overrideScope": "codebaseInvestigator"
      },
      "modelConfig": {
        "generateContentConfig": { "temperature": 0.1 }
      }
    }
  ]
}
```

## 3. Стратегія вирішення (Resolution)

`ModelConfigService` формує фінальну конфігурацію у два кроки:

### Крок 1: Вирішення аліаса

Запитуваний рядок моделі шукається в об'єднаній карті системних `aliases` та
користувацьких `customAliases`.

1.  Якщо знайдено, система рекурсивно проходить по ланцюжку `extends`.
2.  Налаштування об'єднуються від батька до дитини (дитина перемагає).
3.  Результатом є базовий `ResolvedModelConfig`.
4.  Якщо не знайдено, запитуваний рядок вважається сирою назвою моделі.

### Крок 2: Застосування перевизначень

Система оцінює список `overrides` відносно контексту запиту (`model` та
`overrideScope`).

1.  **Фільтрація**: Визначаються всі відповідні перевизначення.
2.  **Сортування**: Результати пріоритезуються за **специфічністю** (кількістю
    ключів, що збіглися в об'єкті `match`).
    - Специфічні збіги (наприклад, `model` + `overrideScope`) перекривають
      широкі (наприклад, лише `model`).
    - Вирішення нічиєї: Якщо специфічність однакова, враховується порядок у
      масиві `overrides` (останній перемагає).
3.  **Злиття**: Конфігурації з відсортованих перевизначень послідовно
    накладаються на базову конфігурацію.

## 4. Довідник конфігурації

Конфігурація відповідає інтерфейсу `ModelConfigServiceConfig`.

### Об'єкт `ModelConfig`

Визначає фактичні параметри для моделі.

| Властивість             | Тип      | Опис                                                                 |
| :---------------------- | :------- | :------------------------------------------------------------------- |
| `model`                 | `string` | Ідентифікатор моделі, що викликається (наприклад, `gemini-2.5-pro`). |
| `generateContentConfig` | `object` | Об'єкт конфігурації, що передається в SDK `@google/genai`.           |

### `GenerateContentConfig` (Спільні параметри)

Прямо відповідає `GenerateContentConfig` у SDK. Спільні параметри включають:

- **`temperature`**: (`number`) Керує випадковістю виводу. Низькі значення (0.0)
  детерміновані; високі (>0.7) — творчі.
- **`topP`**: (`number`) Ймовірність вибірки ядра (nucleus sampling).
- **`maxOutputTokens`**: (`number`) Ліміт довжини згенерованої відповіді.
- **`thinkingConfig`**: (`object`) Конфігурація для моделей із можливостями
  міркування (reasoning), наприклад, `thinkingBudget`, `includeThoughts`.

## 5. Практичні приклади

### Визначення детермінованої бази

Створіть аліас для завдань, що потребують високої точності, розширюючи
стандартну конфігурацію чату, але примусово встановлюючи нульову температуру.

```json
"modelConfigs": {
  "customAliases": {
    "precise-mode": {
      "extends": "chat-base",
      "modelConfig": {
        "generateContentConfig": {
          "temperature": 0.0,
          "topP": 1.0
        }
      }
    }
  }
}
```

### Впровадження параметрів для конкретного агента

Встановіть збільшений бюджет міркувань (thinking budget) для конкретного агента
без зміни глобальних налаштувань, наприклад, для `codebaseInvestigator`.

```json
"modelConfigs": {
  "overrides": [
    {
      "match": {
        "overrideScope": "codebaseInvestigator"
      },
      "modelConfig": {
        "generateContentConfig": {
          "thinkingConfig": { "thinkingBudget": 4096 }
        }
      }
    }
  ]
}
```

### Експериментальна оцінка моделей

Направте трафік для певного аліаса на попередню (preview) модель для A/B
тестування без зміни коду клієнта.

```json
"modelConfigs": {
  "overrides": [
    {
      "match": {
        "model": "gemini-2.5-pro"
      },
      "modelConfig": {
        "model": "gemini-2.5-pro-experimental-001"
      }
    }
  ]
}
```
