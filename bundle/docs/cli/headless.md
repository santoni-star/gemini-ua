# Безголовий режим (Headless mode)

Безголовий режим дозволяє запускати Gemini CLI програмно зі сценаріїв командного
рядка та інструментів автоматизації без інтерактивного інтерфейсу. Це ідеально
підходить для написання скриптів, CI/CD конвеєрів та створення інструментів на
базі ШІ.

- [Безголовий режим](#headless-mode)
  - [Огляд](#overview)
  - [Основне використання](#basic-usage)
    - [Прямі підказки (Prompts)](#direct-prompts)
    - [Ввід через Stdin](#stdin-input)
    - [Поєднання з вводом із файлу](#combining-with-file-input)
  - [Формати виводу](#output-formats)
    - [Текстовий вивід (типово)](#text-output-default)
    - [JSON вивід](#json-output)
      - [Схема відповіді](#response-schema)
      - [Приклад використання](#example-usage)
    - [Потоковий JSON вивід (Streaming)](#streaming-json-output)
      - [Коли використовувати потоковий JSON](#when-to-use-streaming-json)
      - [Типи подій](#event-types)
      - [Основне використання](#basic-usage)
      - [Приклад виводу](#example-output)
      - [Обробка подій потоку](#processing-stream-events)
      - [Реальні приклади](#real-world-examples)
    - [Перенаправлення у файл](#file-redirection)
  - [Параметри конфігурації](#configuration-options)
  - [Приклади](#examples)
    - [Огляд коду](#code-review)
    - [Генерація повідомлень коміту](#generate-commit-messages)
    - [Документація API](#api-documentation)
    - [Пакетний аналіз коду](#batch-code-analysis)
    - [Аналіз логів](#log-analysis)
    - [Генерація нотаток до релізу](#release-notes-generation)
    - [Відстеження використання моделей та інструментів](#model-and-tool-usage-tracking)
  - [Ресурси](#resources)

## Огляд

Безголовий режим надає інтерфейс до Gemini CLI, який:

- Приймає підказки через аргументи командного рядка або stdin.
- Повертає структурований вивід (текст або JSON).
- Підтримує перенаправлення файлів та конвеєри (pipes).
- Забезпечує послідовні коди виходу для обробки помилок.

## Основне використання

### Прямі підказки

Використовуйте прапорець `--prompt` (або `-p`) для запуску в безголовому режимі:

```bash
gemini-ua --prompt "Що таке машинне навчання?"
```

### Ввід через Stdin

Передавайте дані в Gemini CLI через конвеєр:

```bash
echo "Поясни цей код" | gemini-ua
```

### Поєднання з вводом із файлу

Зчитуйте з файлів та обробляйте за допомогою Gemini:

```bash
cat README.md | gemini-ua --prompt "Зроби підсумок цієї документації"
```

## Формати виводу

### Текстовий вивід (типово)

Стандартний людиночитаний вивід:

```bash
gemini-ua -p "Яка столиця Франції?"
```

Формат відповіді:

```
Столиця Франції — Париж.
```

### JSON вивід

Повертає структуровані дані, включаючи відповідь, статистику та метадані. Цей
формат ідеально підходить для програмної обробки та скриптів автоматизації.

#### Схема відповіді

JSON вивід має таку структуру:

```json
{
  "response": "string", // Основний контент, згенерований ШІ
  "stats": {
    // Метрики використання та дані про продуктивність
    "models": {
      // Статистика використання API та токенів по моделях
      "[model-name]": {
        "api": {
          /* кількість запитів, помилки, затримка */
        },
        "tokens": {
          /* підказка, відповідь, кешовані, всього */
        }
      }
    },
    "tools": {
      // Статистика виконання інструментів
      "totalCalls": "number",
      "totalSuccess": "number",
      "totalFail": "number",
      "totalDurationMs": "number",
      "totalDecisions": {
        /* кількість accept, reject, modify, auto_accept */
      },
      "byName": {
        /* детальна статистика по кожному інструменту */
      }
    },
    "files": {
      // Статистика зміни файлів
      "totalLinesAdded": "number",
      "totalLinesRemoved": "number"
    }
  },
  "error": {
    // Присутній лише у разі помилки
    "type": "string", // Тип помилки (наприклад, "ApiError", "AuthError")
    "message": "string", // Людиночитаний опис помилки
    "code": "number" // Опціональний код помилки
  }
}
```

#### Приклад використання

```bash
gemini-ua -p "Яка столиця Франції?" --output-format json
```

### Потоковий JSON вивід (Streaming)

Повертає події в реальному часі у форматі JSON з розділенням новими рядками
(JSONL). Кожна значуща дія (ініціалізація, повідомлення, виклики інструментів)
виводиться негайно.

#### Коли використовувати потоковий JSON

Використовуйте `--output-format stream-json`, коли вам потрібно:

- **Моніторинг прогресу в реальному часі** — бачити виклики інструментів та
  відповіді під час їх появи.
- **Автоматизація на основі подій** — реагувати на конкретні події (наприклад,
  збої інструментів).
- **Живе оновлення UI** — створювати інтерфейси, що показують активність агента
  ШІ.

#### Типи подій

Формат потоку видає 6 типів подій:

1. **`init`** — початок сесії.
2. **`message`** — підказки користувача та відповіді асистента.
3. **`tool_use`** — запити на виклик інструментів з параметрами.
4. **`tool_result`** — результати виконання інструментів (успіх/помилка).
5. **`error`** — некритичні помилки та попередження.
6. **`result`** — фінальний результат сесії з агрегованою статистикою.

### Перенаправлення у файл

Зберігайте вивід у файли або передавайте іншим командам:

```bash
# Зберегти у файл
gemini-ua -p "Поясни Docker" > docker-explanation.txt

# Передати в jq
gemini-ua -p "Що таке Kubernetes?" --output-format json | jq '.response'
```

## Параметри конфігурації

Ключові параметри командного рядка для безголового використання:

| Опція                   | Опис                           | Приклад                                          |
| ----------------------- | ------------------------------ | ------------------------------------------------ |
| `--prompt`, `-p`        | Запуск у безголовому режимі    | `gemini-ua -p "запит"`                           |
| `--output-format`       | Формат виводу (text, json)     | `gemini-ua -p "запит" --output-format json`      |
| `--model`, `-m`         | Вказати модель Gemini          | `gemini-ua -p "запит" -m gemini-2.5-flash`       |
| `--debug`, `-d`         | Увімкнути режим налагодження   | `gemini-ua -p "запит" --debug`                   |
| `--include-directories` | Включити додаткові каталоги    | `gemini-ua -p "запит" --include-directories src` |
| `--yolo`, `-y`          | Автоматично схвалювати всі дії | `gemini-ua -p "запит" --yolo`                    |

## Приклади

#### Огляд коду

```bash
cat src/auth.py | gemini-ua -p "Перевір цей код на проблеми з безпекою" > security-review.txt
```

#### Генерація повідомлень коміту

```bash
result=$(git diff --cached | gemini-ua -p "Напиши лаконічне повідомлення коміту" --output-format json)
echo "$result" | jq -r '.response'
```

## Ресурси

- [Налаштування CLI](../get-started/configuration.md) — повний посібник.
- [Аутентифікація](../get-started/authentication.md) — налаштування входу.
- [Команди](./commands.md) — довідник інтерактивних команд.
- [Туторіали](./tutorials.md) — покрокові інструкції з автоматизації.
