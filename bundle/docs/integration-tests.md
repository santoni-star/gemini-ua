# Інтеграційні тести

Цей документ містить інформацію про фреймворк інтеграційного тестування, що
використовується в цьому проекті.

## Огляд

Інтеграційні тести призначені для перевірки повної функціональності Gemini CLI.
Вони запускають зібраний бінарний файл у контрольованому середовищі та
перевіряють, чи поводиться він правильно при взаємодії з файловою системою.

Ці тести знаходяться в каталозі `integration-tests` і запускаються за допомогою
спеціального інструменту.

## Підготовка до тестування

Перед запуском будь-яких інтеграційних тестів необхідно створити бандл
(виконуваний файл), який ви хочете протестувати:

```bash
npm run bundle
```

Ви повинні повторно запускати цю команду після будь-яких змін у вихідному коді
CLI.

## Запуск тестів

Інтеграційні тести не запускаються автоматично при `npm run test`. Їх потрібно
викликати явно за допомогою сценарію `npm run test:integration:all`.

Також можна використовувати скорочену команду:

```bash
npm run test:e2e
```

## Запуск окремих тестів

Щоб запустити лише певні файли тестів, використовуйте:
`npm run test:e2e <ім'я_файлу1> ....`, де `<ім'я_файлу>` — це будь-який файл
`.test.js` у папці `integration-tests/`.

Приклад:

```bash
npm run test:e2e list_directory write_file
```

### Запуск одного тесту за назвою

Використовуйте прапорець `--test-name-pattern`:

```bash
npm run test:e2e -- --test-name-pattern "reads a file"
```

## Матриця пісочниць (Sandbox)

Команда `all` запустить тести для трьох варіантів: без пісочниці, Docker та
Podman. Окремо їх можна запустити так:

```bash
npm run test:integration:sandbox:none
npm run test:integration:sandbox:docker
npm run test:integration:sandbox:podman
```

## Діагностика

Інструмент тестування надає кілька опцій для пошуку причин збоїв.

### Збереження виводу тестів

Ви можете зберегти тимчасові файли, створені під час тесту, для аналізу. Для
цього встановіть змінну `KEEP_OUTPUT` у значення `true`.

```bash
KEEP_OUTPUT=true npm run test:integration:sandbox:none
```

### Детальний вивід (Verbose)

Для глибшого налагодження встановіть `VERBOSE=true`.

```bash
VERBOSE=true npm run test:integration:sandbox:none
```

## Структура каталогів

Інтеграційні тести створюють унікальний каталог для кожного запуску всередині
папки `.integration-tests`. Це дозволяє легко знайти логи та артефакти
конкретного тесту.

```
.integration-tests/
└── <id-запуску>/
    └── <назва-файлу>.test.js/
        └── <назва-тесту>/
            ├── output.log
            └── ...інші артефакти...
```
